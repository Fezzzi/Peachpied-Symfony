<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

	<PropertyGroup>
		<PropsPath>$([System.IO.Path]::GetFullPath('$(MSBuildThisFileDirectory)'))</PropsPath>
		<TempDir>.\obj</TempDir>
		<RepoPath>$(PropsPath)..\PS-Nuget-Repository\</RepoPath>
		<ManualVersion>false</ManualVersion>
		<ManualReferences>false</ManualReferences>
	</PropertyGroup>
	
	<UsingTask TaskName="WarmLibsCache" AssemblyFile="C:\Users\Fezzi\Documents\MATFYZ\Bc\BAKALARKA\Peachpied_Symfony\Additional-Tools\PSTools\bin\Debug\netstandard2.0\publish\PSTools.dll" />
	<UsingTask TaskName="GetLibVersion" AssemblyFile="C:\Users\Fezzi\Documents\MATFYZ\Bc\BAKALARKA\Peachpied_Symfony\Additional-Tools\PSTools\bin\Debug\netstandard2.0\publish\PSTools.dll" />
	<UsingTask TaskName="GetLibReferences" AssemblyFile="C:\Users\Fezzi\Documents\MATFYZ\Bc\BAKALARKA\Peachpied_Symfony\Additional-Tools\PSTools\bin\Debug\netstandard2.0\publish\PSTools.dll" />

	<!--
	<UsingTask TaskName="WarmLibsCache" AssemblyFile="$(PSToolsFullPath)\PSTools.dll" />
	<UsingTask TaskName="GetLibVersion" AssemblyFile="$(PSToolsFullPath)\PSTools.dll" />
	<UsingTask TaskName="GetLibReferences" AssemblyFile="$(PSToolsFullPath)\PSTools.dll" />
	-->
	
	<ItemGroup>
		<PackageReference Include="Peachpied.Symfony.Tools" Version="1.0.0" />
	</ItemGroup>
	
	<!-- To keep symfony components' cache up to date. -->
	<Target Name="WarmCache" Inputs="$(MSBuildProjectDirectory)\composer.lock" Outputs="$(TempDir)\libsCache.json">
		<Delete Files="$(TempDir)\libsCache.json" Condition="Exists('$(TempDir)\libsCache.json')" />
		<WarmLibsCache ProjPath="$(MSBuildProjectDirectory)" TempPath="$(TempDir)" />
	</Target>
	
	<!-- To ensure libsCache are removed on clear request. -->
	<Target Name="ClearCache" AfterTargets="Clean">
		<Delete Files="$(TempDir)\libsCache.json" Condition="Exists('$(TempDir)\libsCache.json')" />
	</Target>
	
	<!-- Tasks to atuomatize process such as library's version retrieval, dependencies retrieval, ... -->
	<Target Name="AutomatizationTasks" BeforeTargets="CollectPackageReferences" DependsOnTargets="WarmCache">
		<GetLibVersion TempPath="$(TempDir)" LibName="$(MSBuildProjectName)" Condition="$(ManualVersion)!=true">
			<Output TaskParameter="Version" PropertyName="PackageVersion" />
		</GetLibVersion>
		<GetLibReferences TempPath="$(TempDir)" RepoPath="$(RepoPath)" LibName="$(MSBuildProjectName)" Condition="$(ManualReferences)!=true">
			<Output TaskParameter="References" ItemName="PackageReference" />
		</GetLibReferences>
	</Target>
	
</Project>
